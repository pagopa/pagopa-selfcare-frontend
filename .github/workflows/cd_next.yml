name: CD Next Release

on:
  push:
    branches:
      - next


permissions:
  packages: write
  contents: write
  issues: write
  id-token: write
  actions: read


jobs:

  release:
    name: Create a New Release
    runs-on: ubuntu-latest
    steps:
      - name: Make Release
        id: release
        uses: pagopa/github-actions-template/node-release@v1.13.1
        with:
          semver: buildNumber
          github_token: ${{ secrets.BOT_TOKEN_GITHUB }}
          skip_ci: false
          prerelease: true

  deploy:
    needs:
      - release
    name: Deploy on CDN
    uses: ./.github/workflows/deploy_on_cdn.yml
    with:
      environment: 'dev'
    secrets: inherit
